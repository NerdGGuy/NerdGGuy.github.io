<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"></head><body><h1>1487157964.lhs</h1><br><p>Blogging about a Blog<br>---------------------<br><br>Hello Nerds,<br><br>My name is Matthew Green and in my spare time I write Haskell code.<br><br>My blog post will be written in literate Haskell.<br><br>My blog server will be written in Haskell.<br><br>My blog post will follow my adventures into writting a blog about a blog.<br><br>The end.<br></p><h1>1487158273.lhs</h1><br><p>&gt; {-# LANGUAGE OverloadedStrings #-}<br><br>&gt; import Web.Scotty<br>&gt; import Lucid.Base<br>&gt; import Lucid.Html5<br>&gt; import Data.Text.Lazy<br><br>Writting a blog<br>---------------<br><br>Hello Nerds,<br><br>My
 adventure into writting a blog server starts with Scotty and Lucid. The
 Scotty web server framework is as close as a Haskell programmer can get
 to the [WAI](https://hackage.haskell.org/package/wai Web Application 
Interface) without having to know the details.<br><br>&gt; main :: IO ()<br>&gt; main = do<br>&gt;   scotty 3000 $ do<br>&gt;     get "/" $ do<br>&gt;       html $ myblog<br><br>Next I will be using Lucid to typesafely generate the HTML page.<br><br>&gt; myblog :: Text<br>&gt; myblog = renderText $ do<br>&gt;   html_ $ do<br>&gt;     head_ mempty<br>&gt;     body_ $ do<br>&gt;       h1_ $ "My First Blog"<br><br>Ta Da!<br></p><h1>1487160584.lhs</h1><br><p>&gt; {-# LANGUAGE OverloadedStrings #-}<br><br>&gt; import Web.Scotty<br>&gt; import Lucid.Base<br>&gt; import Lucid.Html5<br>&gt; import Data.Text.Lazy (Text(..), pack, replace)<br>&gt; import qualified Data.Text.Lazy.IO as Text (readFile)<br>&gt; import System.Directory<br>&gt; import Control.Monad<br>&gt; import Data.Monoid<br>&gt; import Data.List<br><br>Writting Blog Posts<br>-------------------<br><br>Hello Nerds,<br><br>One
 of the fudamental functions of a blog server is providing posts. In my 
server these posts will be read from a "posts" directory. Each file will
 be named after the timestamp of the post.<br><br>./posts:<br>1487157964.lhs<br>1487158273.lhs<br><br>&gt; main :: IO ()<br>&gt; main = do<br>&gt;   files &lt;- listDirectory "posts"<br>&gt;   myserver (sort files)<br><br>The filenames of the posts directory are first stored by filename then passed onto the myserver function.<br><br>&gt; myserver :: [FilePath] -&gt; IO ()<br>&gt; myserver xs = do<br>&gt;   files &lt;- mapM (\x -&gt; Text.readFile ("posts/" &lt;&gt; x) &gt;&gt;= (\y -&gt; return (pack x, y))) xs<br>&gt;   scotty 3000 $ do<br>&gt;     get "/" $ do<br>&gt;       html $ myblog files<br><br>The server reads the files into memory and passed the filename and content onto the myblog html builder.<br><br>&gt; myblog :: [(Text,Text)] -&gt; Text<br>&gt; myblog xs = renderText $ do<br>&gt;   html_ $ do<br>&gt;     head_ mempty<br>&gt;     body_ $ do<br>&gt;       foldl (\m (x,y) -&gt; m &gt;&gt; h1_ (toHtmlRaw x) &gt;&gt; br_ [] &gt;&gt; p_ (toHtmlRaw $ replace "\n" "<br>" y)) mempty xs<br><br>The
 raw filename and file contents are inserted into a paragraph. To make 
sure the file contents has line breaks I convert all character returns 
into <br> elements.<br></p></body></html>